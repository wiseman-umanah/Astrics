{% load social_share %}
{% load space_extras %}

{% for post in posts %}
	<div class="post-container">
		<div class="post-top">
			<div class="post-details">
				<a href="{{ post.user.get_absolute_url }}">
					<div class="profile-div-small">
						<img src="{{ post.user|get_pic_link:1 }}" alt="Profile Picture">
					</div>
				</a>
				<div>
					{% if post.title %}
						<h4>{{ post.title }}</h4>
					{% endif %}
					<small>{{ post.created_at }} | <a href="{{ post.user.get_absolute_url }}"> {{ post.user.username }} </a></small>
				</div>
			</div>
		
			<div class="options">
				<i class='bx bx-dots-vertical-rounded' style='color:#ffffff'  ></i>
				<div class="options-dropdown" data-post_id="{{ post.id }}">
					{% if post.in_favorite %}
						<div class="save-btn">Remove from Favorite</div>
					{% else %}
						<div class="save-btn">Save to Favorite</div>
					{% endif %}
				</div>
			</div>
		</div>
		{% if post.description %}
			<div>
				{{ post.description }}
			</div>
		{% endif %}
		{% if post.media_type == "image" %}
			<div class="post-media">
				<img src="{{ post.file_id|get_media }}">
			</div>	
		{% elif post.media_type == "video" %}
			<div class="post-media">
				<video src="{{ post.file_id|get_media }}" controls muted>
			</div>	
		{% endif %}
			
		<div class="interactions">
			<div>
				{% if post.is_liked %}
					<button class="reaction-btn" data-post_id="{{ post.id }}">
						<small>Love</small>
						<i class='bx bxs-heart'></i>
				{% else %}
					<button class="reaction-btn" data-post_id="{{ post.id }}">
						<small>Love</small>
						<i class='bx bx-heart'></i>
				{% endif %}
				</button>
				<div class="share-btn">
					<small>Share</small>
					<i class='bx bxs-share-alt' style='color:#f80000'  ></i>
					<div>
						{% comment %} {% post_to_facebook post.get_absolute_url '<i class="bx bx-facebook" style="color:#ffffff"></i>' %} {% endcomment %}
					</div>
				</div>
			</div>
			<div class="reaction-count">
				<small>{{ post.likes.count }} love{{ post.likes.count | pluralize }} . {{ post.comments.count }} comment{{ post.comments.count | pluralize }}</small>
			</div>
		</div>
		<form class="comment-section" action="{% url 'space:create_comment' post.id %}">
			<div class="input-box">	
				<textarea name="content" id="id_content" cols="40" rows="1" placeholder="Share your thought here" class="newpost_description"></textarea>
			</div>
			<button class="comment-btn" data-post_id="{{ post.id }}">Comment</button>
		</form>
	</div>
{% endfor %}
	<script>
    let page = 1;
    let empty_page = false;
    let block_request = false;
    let username = '{{ username }}';

    $(window).scroll(function() {
        let margin = $(document).height() - $(window).height() - 200;
        if ($(window).scrollTop() > margin && empty_page == false && block_request == false) {
            block_request = true;
            page += 1;
            
            $.get(username + '/posts/?page=' + page, function(data) {
                if (data == '') {
                    empty_page = true;
                } else {
                    block_request = false;
                    $('.posts').append(data);
                }
            })
        }
    });
</script>
